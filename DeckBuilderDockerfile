FROM node:24-alpine AS builder

WORKDIR /app

RUN corepack enable

COPY package.json pnpm-lock.yaml tsconfig.json ./
COPY src ./src

RUN pnpm install --frozen-lockfile

ARG DEV_MODE=true

RUN if [ "$DEV_MODE" = "true" ]; then \
    pnpm build:deck-builder:dev; \
    else \
    pnpm build:deck-builder; \
    fi

FROM caddy:2.10.2-alpine AS runner

WORKDIR /usr/share/caddy

COPY Caddyfile /etc/caddy/Caddyfile
COPY --from=builder /app/output/deck-builder/browser .
